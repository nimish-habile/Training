SET SERVEROUTPUT ON;
CREATE OR REPLACE
PROCEDURE SP_POPULATE_USER(
    P_USER_ID IN VARCHAR2)
IS
  V_ID VARCHAR2(36);
  V_ADDRESS_ID TAR_ADDRESS.ID%TYPE;
  CURSOR USER_CURSOR
  IS
    SELECT FIRST_NAME,
      LAST_NAME,
      MIDDLE_NAME,
      MANABADI_ID,
      EMAIL,
      CONTACT_NUMBER,
      ADDRESS
    FROM SRC_USER;
  --  USER_REC USER_CURSOR%ROWTYPE;
BEGIN
  --  DBMS_OUTPUT.ENABLE;
  FOR USER_REC IN USER_CURSOR
  LOOP
    V_ID := SYS_GUID();
    --    DBMS_OUTPUT.PUT_LINE('Processing User: ' || USER_REC.FIRST_NAME || ' ' || USER_REC.LAST_NAME);
    BEGIN
      SELECT ID INTO V_ADDRESS_ID FROM TAR_ADDRESS WHERE ADDRESS = USER_REC.ADDRESS;
      --     DBMS_OUTPUT.PUT_LINE('Address ID Found: ' || V_ADDRESS_ID);
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
      V_ADDRESS_ID := NULL;
      --      DBMS_OUTPUT.PUT_LINE('No Address ID Found for Address: ' || USER_REC.ADDRESS);
    END;
    INSERT
    INTO TAR_USER
      (
        ID,
        FIRST_NAME,
        LAST_NAME,
        MIDDLE_NAME,
        CONTACT_NUMBER,
        MANABADI_EMAIL,
        PERSONAL_EMAIL,
        ADDRESS_ID,
        CREATED_BY,
        UPDATED_BY
      )
      VALUES
      (
        V_ID,
        USER_REC.FIRST_NAME,
        USER_REC.LAST_NAME,
        USER_REC.MIDDLE_NAME,
        USER_REC.CONTACT_NUMBER,
        USER_REC.MANABADI_ID,
        USER_REC.EMAIL,
        V_ADDRESS_ID,
        P_USER_ID,
        P_USER_ID
      );
    --      DBMS_OUTPUT.PUT_LINE('Inserted User ID: ' || V_ID);
  END LOOP;
END;
/
DECLARE
BEGIN
  SP_POPULATE_USER('NIMISH');
END;
/